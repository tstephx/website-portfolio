<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noindex, nofollow">
    <meta name="description" content="Case study: Diagnosing 8 root causes behind a failing eligibility process and building a 6-step SQL pipeline that increased Pinnacle fill rate from 57.9% to 94.1%.">
    <title>Pinnacle Selection Automation | Taylor Stephens</title>
    <link rel="icon" href="../../favicon.svg" type="image/svg+xml">
    <meta property="og:title" content="Pinnacle Selection Automation | Taylor Stephens">
    <meta property="og:description" content="Diagnosed 8 root causes, built a 6-step SQL pipeline on Amazon Redshift, increased Pinnacle fill rate from 57.9% to 94.1% â€” hitting 100% in July.">
    <meta property="og:type" content="article">
    <link rel="canonical" href="https://taylorstephens.io/work/pinnacle-program-selection/">
    <meta name="theme-color" content="#2563eb">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Lora:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../css/styles.css">
    <link rel="stylesheet" href="../../css/case-study.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js" defer></script>
    <script src="../../js/progress-bar.js" defer></script>
</head>
<body>

    <div class="reading-progress"></div>
    <a class="skip-link" href="#main-content">Skip to content</a>

    <nav class="back-nav" aria-label="Back navigation">
        <a href="../../index.html#projects">&larr; Back to Portfolio</a>
    </nav>

    <main id="main-content" class="case-study">

        <header class="cs-header">
            <h1>From Crashing Excel to Real-Time Automation</h1>
            <p class="cs-tagline">I diagnosed 8 root causes behind a failing eligibility process &mdash; then designed and built a 6-step SQL pipeline on Amazon Redshift that replaced a crashing 55MB Excel file and increased Pinnacle fill rate from 57.9% to 94.1%.</p>
            <div class="tech-pills">
                <span class="tech-pill">SQL / Redshift</span>
                <span class="tech-pill">Haversine Formula</span>
                <span class="tech-pill">Window Functions</span>
                <span class="tech-pill">Process Architecture</span>
            </div>
        </header>

        <div class="scope-callout">
            <div class="scope-item">
                <span class="scope-label">Timeline</span>
                <span class="scope-value">2023&ndash;2025</span>
            </div>
            <div class="scope-item">
                <span class="scope-label">My Role</span>
                <span class="scope-value">Process Architect &amp; Technical Lead</span>
            </div>
            <div class="scope-item">
                <span class="scope-label">Data Scale</span>
                <span class="scope-value">2,620 DSPs, 5+ data sources, 9 quarterly snapshots</span>
            </div>
            <div class="scope-item">
                <span class="scope-label">Impact</span>
                <span class="scope-value">94.1% fill rate (+36 pp), 1&rarr;5 BDM team</span>
            </div>
        </div>

        <section class="cs-section" id="problem">
            <h2>A Spreadsheet That Couldn&rsquo;t Handle Its Own Data</h2>
            <p>Amazon&rsquo;s &ldquo;Pinnacle&rdquo; program assigns top-performing Delivery Service Partners (independent business owners running delivery fleets) to premium, high-volume stations across Multi-Station, Middle Mile, DSP Lite, and other expansion operations. To grow the network, someone has to determine which partners are eligible for which stations &mdash; matching geography, performance, and capacity across thousands of combinations.</p>
            <p>This eligibility process ran on a 55+ MB Excel file with INDEX-MATCH calculations across 24,000 rows. It crashed regularly. The distance calculations came from a &ldquo;Who&rsquo;s My Neighbor Dashboard&rdquo; that computed traffic-dependent commute distances &mdash; the same partner-to-station pair could show 49 miles one month and 52 the next. Eligibility data refreshed quarterly while performance updated monthly, creating blind spots between cycles. The entire system was maintained by a single person.</p>

            <div class="chart-container">
                <div class="chart-label">Pinnacle Launches: System Failure Impact</div>
                <canvas id="launchChart" aria-label="Bar chart showing Pinnacle launches dropping from 93 in 2023 to 42 in 2024"></canvas>
            </div>

            <p>Pinnacle launches dropped 55% (from 93 to 42) and 20 eligible candidates were bypassed entirely. But the real damage was structural. Amazon&rsquo;s capacity planning follows a 5-lever prioritization hierarchy &mdash; where Pinnacle expansion (Rank 3) must be exhausted before falling to net-new RTO recruitment (Rank 5). Instead, those 20 targets jumped directly to RTO, violating the program&rsquo;s own prioritization tenets and breaking the reward mechanism that top-performing DSPs had earned.</p>

            <div class="insight-callout">
                A 55MB Excel file with 24,000-row INDEX-MATCH formulas isn&rsquo;t a tool &mdash; it&rsquo;s a system screaming for a database. And when it crashes, you don&rsquo;t lose a file. You lose candidates &mdash; and violate the rules that protect your best operators.
            </div>
        </section>

        <section class="cs-section" id="approach">
            <h2>8 Root Causes, Not Just a Crashing Spreadsheet</h2>
            <p>What leadership saw as &ldquo;the Excel file crashes&rdquo; was actually 8 distinct root causes spanning three dimensions. Fixing any one alone would leave the others to cause the next failure.</p>

            <table class="data-table">
                <caption>8 root causes diagnosed across data, process, and tooling</caption>
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Root Cause</th>
                        <th>Dimension</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="highlight">1</td>
                        <td>Quarterly data lag &mdash; eligibility updated quarterly while performance updated monthly</td>
                        <td>Data</td>
                    </tr>
                    <tr>
                        <td class="highlight">2</td>
                        <td>Variable commute distances &mdash; traffic-dependent, non-deterministic (49mi one month, 52mi the next)</td>
                        <td>Data</td>
                    </tr>
                    <tr>
                        <td class="highlight">3</td>
                        <td>RSR Capacity Reliability defects from 2023 contaminating eligibility determinations</td>
                        <td>Data</td>
                    </tr>
                    <tr>
                        <td class="highlight">4</td>
                        <td>Double-counting &mdash; DSPs already operating second stations inflating eligibility counts</td>
                        <td>Data</td>
                    </tr>
                    <tr>
                        <td class="highlight">5</td>
                        <td>Inconsistent prioritization &mdash; tracker framework didn&rsquo;t match strategy documents</td>
                        <td>Process</td>
                    </tr>
                    <tr>
                        <td class="highlight">6</td>
                        <td>Vetting history gaps &mdash; 12-month waits, bans without documentation or reconsideration dates</td>
                        <td>Process</td>
                    </tr>
                    <tr>
                        <td class="highlight">7</td>
                        <td>Unclear training &mdash; tracker usage instructions incomplete for new analysts</td>
                        <td>Process</td>
                    </tr>
                    <tr>
                        <td class="highlight">8</td>
                        <td>Excel infrastructure collapse &mdash; 55+MB file, single point of failure for the entire process</td>
                        <td>Tooling</td>
                    </tr>
                </tbody>
            </table>

            <p>The solution needed to address all 8 simultaneously. I designed a 6-step SQL pipeline on Amazon Redshift that replaced every component: data extraction, consecutive-period validation, vetting integration, geospatial distance calculation, prioritized ranking, and downstream delivery.</p>

            <h3>Eligibility Funnel</h3>
            <p>The pipeline implements a progressive filtering funnel &mdash; narrowing 2,620 DSPs to a ranked candidate list per station. Each stage maps to a diagnosed root cause.</p>

            <div class="funnel-chart">
                <div class="funnel-stage" style="--width: 100%">
                    <span class="stage-label">NA DSP Network</span>
                    <span class="stage-value">2,620</span>
                </div>
                <div class="funnel-stage" style="--width: 55%">
                    <span class="stage-label">Tier 1 Designation</span>
                    <span class="stage-value">222<span class="stage-drop">8.5%</span></span>
                </div>
                <div class="funnel-stage" style="--width: 45%">
                    <span class="stage-label">Consecutive Tier 1</span>
                    <span class="stage-value">~180</span>
                </div>
                <div class="funnel-stage" style="--width: 38%">
                    <span class="stage-label">Tenure Qualified (12+ months)</span>
                    <span class="stage-value">~160</span>
                </div>
                <div class="funnel-stage" style="--width: 30%">
                    <span class="stage-label">MSO Vetting Clear</span>
                    <span class="stage-value">~140</span>
                </div>
                <div class="funnel-stage" style="--width: 18%">
                    <span class="stage-label">Distance Matched &amp; Prioritized</span>
                    <span class="stage-value">Ranked per station</span>
                </div>
            </div>
        </section>

        <section class="cs-section" id="technical">
            <h2>Why Consistency Beat Accuracy</h2>

            <h3>Haversine Distance Formula</h3>
            <p>The &ldquo;Who&rsquo;s My Neighbor Dashboard&rdquo; computed driving distances that varied with traffic conditions &mdash; the same partner-to-station pair could show different distances depending on when you checked. I replaced it with the Haversine formula for great-circle distance calculations: consistent, reproducible, and fast. While driving distance is more accurate in absolute terms, consistency mattered more for eligibility ranking. A decision system needs the same inputs to produce the same outputs every time.</p>

            <div class="formula-box">
                <div class="formula-label">Haversine Formula</div>
                <div class="formula">
                    d = 2r &middot; arcsin(&radic;(sin&sup2;(&Delta;&phi;/2) + cos(&phi;1) &middot; cos(&phi;2) &middot; sin&sup2;(&Delta;&lambda;/2)))
                </div>
                <p class="formula-note">Great-circle distance between two points on a sphere &mdash; consistent, reproducible, traffic-independent</p>
            </div>

            <h3>6-Step SQL Query Architecture</h3>
            <p>The pipeline transforms raw data into a prioritized outreach list through six modular stages. Each stage addresses specific root causes and can be tested independently.</p>
            <ul>
                <li><strong>Stage 1 &mdash; Snapshot Configuration:</strong> Maps 9 quarterly snapshots (2022Q1&ndash;2024Q3) that lock Network Health scores for consistent eligibility evaluation. Solves root cause #1 (quarterly lag).</li>
                <li><strong>Stage 2 &mdash; Consecutive Tier 1 Validation:</strong> Uses LAG() window functions to verify consecutive-period Tier 1 status across two quarters &mdash; preventing one-quarter flukes from qualifying DSPs for three-year contracts. Snapshot-locked tier data also isolates the 2023 CR defect period. Solves root causes #1 and #3.</li>
                <li><strong>Stage 3 &mdash; Vetting Integration:</strong> Joins tier-validated DSPs with MSO vetting history, applies a 33-DSP exclusion list, and deduplicates transfer records via ROW_NUMBER(). Surfaces exclusion reasons and reconsideration dates. Solves root causes #4 (double-counting) and #6 (vetting gaps).</li>
                <li><strong>Stage 4 &mdash; Station Coordinates:</strong> Ingests station latitude and longitude from the master station table for distance computation.</li>
                <li><strong>Stage 5 &mdash; Haversine Distance:</strong> CROSS JOIN of all station pairs with Haversine formula, filtered to &le;250 miles and ranked by proximity. Replaces the traffic-dependent metric with a deterministic constant. Solves root cause #2.</li>
                <li><strong>Stage 6 &mdash; Prioritized Selection:</strong> Two-tier distance filter with intelligent fallback. Outreach priority encoded directly in the ranking to match approved policy tenets. Solves root cause #5 (inconsistent prioritization).</li>
            </ul>

            <h3>Two-Tier Distance Filter</h3>
            <p>Not every station has eligible candidates nearby. The original process had no fallback &mdash; remote or island stations simply went unfilled. I designed a two-tier filter: candidates within 50 miles get priority; if none exist for a station, the 5 closest within 250 miles are included via a NOT EXISTS subquery. The fallback never competes with primary matches &mdash; it only activates for stations that would otherwise be orphaned.</p>

            <h3>What the Automation Feeds</h3>
            <p>The SQL pipeline&rsquo;s output isn&rsquo;t the endpoint &mdash; it feeds into two structured organizational processes I mapped end-to-end. Candidates first enter an 8-day SLA Amazon Approvals process (5 steps across 4 stakeholder groups: LRP, BI, Acquisition, and Leadership), then a 3-week Business Plan Review vetting cycle with panel-style interviews and a 106/150 point threshold. By the time a candidate reaches BPR, they&rsquo;ve been systematically validated across performance, tenure, vetting history, and geography &mdash; eliminating the manual identification bottleneck that caused 20 missed opportunities.</p>
        </section>

        <section class="cs-section" id="under-the-hood">
            <h2>Under the Hood</h2>
            <p>The descriptions above trace the pipeline&rsquo;s logic. Here&rsquo;s what the actual production SQL looks like &mdash; three excerpts from the 6-step Redshift query.</p>

            <h3>Stage 2 &mdash; Consecutive Tier 1 Validation</h3>
            <div class="code-annotation">
                <div class="code-annotation-header">
                    <p class="code-annotation-title">LAG() Window Function &mdash; Temporal Business Rule</p>
                    <span class="code-annotation-lang">SQL</span>
                </div>
                <p class="code-annotation-desc">Window functions validate that a DSP held Tier 1 across consecutive quarters &mdash; not just once. This single clause prevents one-quarter flukes from qualifying DSPs for three-year contracts.</p>
<pre><code>static_tier AS (
    SELECT dsp_id, snapshot_date, adjusted_tier,
        LAG(adjusted_tier, 1) OVER (
            PARTITION BY dsp_id ORDER BY snapshot_date
        ) AS prev_tier
    FROM dsp_network_health
    WHERE snapshot_date IN (SELECT snapshot_date FROM nh_score_config)
)
SELECT * FROM static_tier
WHERE adjusted_tier = 1 AND prev_tier = 1</code></pre>
            </div>

            <h3>Stage 5 &mdash; Haversine Distance Computation</h3>
            <div class="code-annotation">
                <div class="code-annotation-header">
                    <p class="code-annotation-title">CROSS JOIN + Great-Circle Distance</p>
                    <span class="code-annotation-lang">SQL</span>
                </div>
                <p class="code-annotation-desc">Every station paired with every other station, distance computed via Haversine formula. Deterministic &mdash; same inputs always produce the same output, unlike traffic-dependent alternatives.</p>
<pre><code>station_pairs AS (
    SELECT a.station_code AS station_a,
           b.station_code AS station_b,
        3959 * ACOS(
            COS(RADIANS(a.lat)) * COS(RADIANS(b.lat))
            * COS(RADIANS(b.lon) - RADIANS(a.lon))
            + SIN(RADIANS(a.lat)) * SIN(RADIANS(b.lat))
        ) AS distance_miles
    FROM temp_station_data a
    CROSS JOIN temp_station_data b
    WHERE a.station_code &lt;&gt; b.station_code
)</code></pre>
            </div>

            <h3>Stage 6 &mdash; Two-Tier Policy Fallback</h3>
            <div class="code-annotation">
                <div class="code-annotation-header">
                    <p class="code-annotation-title">NOT EXISTS Subquery &mdash; Policy Encoded as SQL</p>
                    <span class="code-annotation-lang">SQL</span>
                </div>
                <p class="code-annotation-desc">Policy encoded as SQL: candidates within 50 miles get priority. Remote stations with no nearby candidates fall back to the 5 closest within 250 miles. The fallback never competes with primary matches.</p>
<pre><code>WHERE distance_miles &lt;= 50
   OR (distance_miles &lt;= 250
       AND proximity_rank &lt;= 5
       AND NOT EXISTS (
           SELECT 1 FROM station_pairs sp2
           WHERE sp2.station_a = sp.station_a
             AND sp2.distance_miles &lt;= 50
       ))</code></pre>
            </div>
        </section>

        <section class="cs-section" id="results">
            <h2>From 57.9% to 94.1% Fill Rate</h2>

            <div class="metrics-row">
                <div class="metric-card">
                    <span class="metric-number">94.1%</span>
                    <span class="metric-label">Pinnacle Fill Rate</span>
                    <span class="metric-subtitle">Up from 57.9% (+36 pp)</span>
                </div>
                <div class="metric-card">
                    <span class="metric-number">100%</span>
                    <span class="metric-label">July Fill Rate</span>
                    <span class="metric-subtitle">8 targets: 1 MMRO, 1 XL, 7 ZL</span>
                </div>
                <div class="metric-card">
                    <span class="metric-number">20</span>
                    <span class="metric-label">Candidates Preserved</span>
                    <span class="metric-subtitle">Previously bypassed to RTO</span>
                </div>
                <div class="metric-card">
                    <span class="metric-number">1 &rarr; 5</span>
                    <span class="metric-label">BDM Team</span>
                    <span class="metric-subtitle">5&times; outreach capacity</span>
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-label">Fill Rate Trajectory</div>
                <canvas id="fillRateChart" aria-label="Line chart showing fill rate improvement from 57.9% to 94.1%, peaking at 100% in July"></canvas>
            </div>

            <p>Pinnacle fill rate jumped from 57.9% to 94.1% &mdash; a 36 percentage-point increase &mdash; with July hitting 100% across all 8 targets. The 20 eligible candidates who had been bypassed to RTO were identified and preserved, restoring the 5-lever prioritization hierarchy. The automation also enabled the Pinnacle BDM team to expand from 1 member to 5 by providing reliable candidate pipelines that didn&rsquo;t require manual Excel manipulation.</p>
            <p>Data refresh improved from quarterly to monthly &mdash; 3&times; faster updates. The crashing Excel file was replaced with a self-documenting SQL pipeline that runs identically for any analyst, eliminating the single point of failure. Each of the 6 query stages can be tested, debugged, and updated independently. The Haversine distance module is reusable for any station-pair proximity calculation across the network.</p>

            <table class="data-table">
                <caption>System transformation: before and after automation</caption>
                <thead>
                    <tr>
                        <th>Before</th>
                        <th>After</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>55+ MB Excel file (crashes regularly)</td>
                        <td class="highlight">6-step SQL pipeline on Amazon Redshift</td>
                    </tr>
                    <tr>
                        <td>Traffic-dependent commute distances</td>
                        <td class="highlight">Haversine constant (deterministic)</td>
                    </tr>
                    <tr>
                        <td>Quarterly data refresh</td>
                        <td class="highlight">Monthly NH integration (3&times; faster)</td>
                    </tr>
                    <tr>
                        <td>Double-counting in WBR reports</td>
                        <td class="highlight">ROW_NUMBER() deduplication</td>
                    </tr>
                    <tr>
                        <td>20 candidates bypassed to RTO</td>
                        <td class="highlight">0 candidates missed</td>
                    </tr>
                    <tr>
                        <td>Manual Excel identification</td>
                        <td class="highlight">Automated per-station ranked lists</td>
                    </tr>
                    <tr>
                        <td>1 BDM team member</td>
                        <td class="highlight">5 BDM members (5&times; capacity)</td>
                    </tr>
                    <tr>
                        <td>57.9% fill rate (42 launches)</td>
                        <td class="highlight">94.1% fill rate (100% in July)</td>
                    </tr>
                </tbody>
            </table>

            <p>Leadership documentation credited the work directly: <em>&ldquo;The acquisition team will create a script that automatically identifies the prioritized list of Pinnacle eligible candidates for each site (Taylor Stephens, ECD: completed).&rdquo;</em></p>
        </section>

        <section class="cs-section" id="lessons">
            <h2>What This Taught Me</h2>
            <ul class="lessons-list">
                <li>Excel heroics are a sign of missing infrastructure. A 55MB file with 24,000-row INDEX-MATCH formulas is a system screaming for a database. The heroism is the symptom, not the solution.</li>
                <li>Consistency often beats accuracy. Haversine distances aren&rsquo;t as &ldquo;accurate&rdquo; as driving distances, but they&rsquo;re reproducible &mdash; and reproducibility is what eligibility decisions require. The same inputs must produce the same outputs.</li>
                <li>A crashing spreadsheet is never just a crashing spreadsheet. What looked like one tooling problem was 8 root causes across 3 dimensions. Fixing the Excel without diagnosing the data lag, vetting gaps, and prioritization misalignment would have produced a faster wrong answer.</li>
                <li>Automation doesn&rsquo;t just speed things up &mdash; it enforces rules. The 5-lever hierarchy existed on paper, but a manual process let 20 targets skip from Rank 3 to Rank 5. The SQL pipeline mechanizes the hierarchy so prioritization tenets cannot be violated.</li>
            </ul>
        </section>

        <section class="cs-cta">
            <p>Next: <a href="../pinnacle-station/pinnacle-distance.html">Pinnacle Station Distance Analysis</a></p>
        </section>

    </main>

    <footer>
        <p>&copy; 2026 Taylor Stephens. All rights reserved.</p>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        var accent = '#2563eb';
        var muted = 'rgba(107, 107, 107, 0.3)';
        var red = '#dc3545';
        var green = '#16a34a';
        var defaults = {
            responsive: true,
            maintainAspectRatio: true,
            animation: { duration: 1200, easing: 'easeOutQuart' },
            plugins: {
                legend: { display: false },
                tooltip: {
                    backgroundColor: '#1a1a1a',
                    titleFont: { family: "'Inter', sans-serif", size: 12 },
                    bodyFont: { family: "'Inter', sans-serif", size: 12 },
                    padding: 10,
                    cornerRadius: 4
                }
            }
        };

        // Launch comparison chart
        new Chart(document.getElementById('launchChart'), {
            type: 'bar',
            data: {
                labels: ['2023 (Working System)', '2024 (System Failure)'],
                datasets: [{
                    data: [93, 42],
                    backgroundColor: [muted, red],
                    borderRadius: 4,
                    barThickness: 60
                }]
            },
            options: Object.assign({}, defaults, {
                aspectRatio: 2.5,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 110,
                        grid: { color: 'rgba(0,0,0,0.04)' },
                        ticks: {
                            font: { family: "'Inter', sans-serif", size: 11 },
                            color: '#6b6b6b',
                            callback: function(v) { return v + ' launches'; }
                        }
                    },
                    x: {
                        grid: { display: false },
                        ticks: {
                            font: { family: "'Inter', sans-serif", size: 11, weight: 600 },
                            color: '#3d3d3d'
                        }
                    }
                }
            })
        });

        // Fill rate trajectory line chart
        new Chart(document.getElementById('fillRateChart'), {
            type: 'line',
            data: {
                labels: ['Before', 'Peak (July)', 'Sustained'],
                datasets: [{
                    label: 'Fill Rate',
                    data: [57.9, 100, 94.1],
                    borderColor: green,
                    backgroundColor: 'rgba(22, 163, 74, 0.08)',
                    borderWidth: 2.5,
                    pointBackgroundColor: function(ctx) {
                        return ctx.dataIndex === 1 ? '#15803d' : green;
                    },
                    pointRadius: function(ctx) {
                        return ctx.dataIndex === 1 ? 6 : 4;
                    },
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    fill: true,
                    tension: 0.3
                }]
            },
            options: Object.assign({}, defaults, {
                aspectRatio: 2.2,
                scales: {
                    y: {
                        min: 50,
                        max: 105,
                        grid: { color: 'rgba(0,0,0,0.04)' },
                        ticks: {
                            font: { family: "'Inter', sans-serif", size: 11 },
                            color: '#6b6b6b',
                            callback: function(v) { return v + '%'; }
                        }
                    },
                    x: {
                        grid: { display: false },
                        ticks: {
                            font: { family: "'Inter', sans-serif", size: 11 },
                            color: '#6b6b6b'
                        }
                    }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: '#1a1a1a',
                        callbacks: {
                            label: function(ctx) {
                                var label = ctx.parsed.y + '% fill rate';
                                if (ctx.dataIndex === 1) label += ' (peak)';
                                return label;
                            }
                        }
                    }
                }
            })
        });
    });
    </script>

</body>
</html>
